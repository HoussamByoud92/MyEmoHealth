
  .   ____          _            __ _ _
 /\\ / ___'_ __ _ _(_)_ __  __ _ \ \ \ \
( ( )\___ | '_ | '_| | '_ \/ _` | \ \ \ \
 \\/  ___)| |_)| | | | | || (_| |  ) ) ) )
  '  |____| .__|_| |_|_| |_\__, | / / / /
 =========|_|==============|___/=/_/_/_/
 :: Spring Boot ::                (v3.2.0)

2025-12-15 21:43:33 - Starting MyEmoHealthApplication v1.0.0-SNAPSHOT using Java 17.0.17 with PID 1 (/app/app.jar started by root in /app)
2025-12-15 21:43:33 - Running with Spring Boot v3.2.0, Spring v6.1.1
2025-12-15 21:43:33 - No active profile set, falling back to 1 default profile: "default"
2025-12-15 21:43:35 - Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2025-12-15 21:43:35 - Finished Spring Data repository scanning in 67 ms. Found 12 JPA repository interfaces.
2025-12-15 21:43:36 - Tomcat initialized with port 8082 (http)
2025-12-15 21:43:36 - Starting service [Tomcat]
2025-12-15 21:43:36 - Starting Servlet engine: [Apache Tomcat/10.1.16]
2025-12-15 21:43:36 - Initializing Spring embedded WebApplicationContext
2025-12-15 21:43:36 - Root WebApplicationContext: initialization completed in 2915 ms
2025-12-15 21:43:36 - Filter 'jwtAuthenticationFilter' configured for use
2025-12-15 21:43:36 - HHH000204: Processing PersistenceUnitInfo [name: default]
2025-12-15 21:43:37 - HHH000412: Hibernate ORM core version 6.3.1.Final
2025-12-15 21:43:37 - HHH000026: Second-level cache disabled
2025-12-15 21:43:37 - No LoadTimeWeaver setup: ignoring JPA class transformer
2025-12-15 21:43:37 - HikariPool-1 - Starting...
2025-12-15 21:43:37 - HikariPool-1 - Added connection org.postgresql.jdbc.PgConnection@502c2278
2025-12-15 21:43:37 - HikariPool-1 - Start completed.
2025-12-15 21:43:37 - HHH90000025: PostgreSQLDialect does not need to be specified explicitly using 'hibernate.dialect' (remove the property setting and it will be selected by default)
2025-12-15 21:43:39 - HHH000489: No JTA platform available (set 'hibernate.transaction.jta.platform' to enable JTA platform integration)
2025-12-15 21:43:39 - 
    alter table if exists chat_message 
       add column content TEXT
2025-12-15 21:43:39 - 
    alter table if exists chat_message 
       add column read boolean not null
2025-12-15 21:43:39 - 
    alter table if exists chat_message 
       add column recipient_id bigint
2025-12-15 21:43:39 - 
    alter table if exists chat_message 
       add column timestamp timestamp(6)
2025-12-15 21:43:39 - 
    alter table if exists chat_message 
       add column type varchar(255)
2025-12-15 21:43:39 - 
    alter table if exists role 
       alter column id set data type bigint
2025-12-15 21:43:39 - 
    alter table if exists "user" 
       alter column role_id set data type bigint
2025-12-15 21:43:39 - 
    create table voice_session (
        id bigserial not null,
        ai_response TEXT,
        patient_id bigint,
        risk_score integer not null,
        sentiment_detected varchar(255),
        timestamp timestamp(6),
        user_transcript TEXT,
        primary key (id)
    )
2025-12-15 21:43:39 - 
    alter table if exists test_instance 
       add constraint FK5xtwc5b48wn6dxi8099tls6tv 
       foreign key (patient_id) 
       references patient_profile
2025-12-15 21:43:39 - Initialized JPA EntityManagerFactory for persistence unit 'default'
2025-12-15 21:43:40 - Hibernate is in classpath; If applicable, HQL parser will be used.
2025-12-15 21:43:42 - 

Using generated security password: 9d6a62d4-1100-403b-b4e1-ab7337505116

This generated password is for development use only. Your security configuration must be updated before running your application in production.

2025-12-15 21:43:42 - Patterns [/ws/**] in 'stompWebSocketHandlerMapping'
2025-12-15 21:43:42 - 42 mappings in 'requestMappingHandlerMapping'
2025-12-15 21:43:42 - Patterns [/webjars/**, /**] in 'resourceHandlerMapping'
2025-12-15 21:43:42 - Will secure any request with [org.springframework.security.web.session.DisableEncodeUrlFilter@4f90b4c9, org.springframework.security.web.context.request.async.WebAsyncManagerIntegrationFilter@16fc3be9, org.springframework.security.web.context.SecurityContextHolderFilter@2114955c, org.springframework.security.web.header.HeaderWriterFilter@222e4377, org.springframework.web.filter.CorsFilter@5afd2f4e, org.springframework.security.web.authentication.logout.LogoutFilter@7db644d5, com.myemohealth.security.JwtAuthenticationFilter@1f87607c, org.springframework.security.web.savedrequest.RequestCacheAwareFilter@6e5506c9, org.springframework.security.web.servletapi.SecurityContextHolderAwareRequestFilter@446b74b9, org.springframework.security.web.authentication.AnonymousAuthenticationFilter@3e5f458f, org.springframework.security.web.session.SessionManagementFilter@60483dcf, org.springframework.security.web.access.ExceptionTranslationFilter@23c6556b, org.springframework.security.web.access.intercept.AuthorizationFilter@286e2b71]
2025-12-15 21:43:43 - 
	c.m.c.VoiceController:
	
2025-12-15 21:43:43 - 
	c.m.c.AuthController:
	
2025-12-15 21:43:43 - 
	c.m.c.DashboardController:
	
2025-12-15 21:43:43 - 
	c.m.c.TestController:
	
2025-12-15 21:43:43 - 
	c.m.c.QcmController:
	
2025-12-15 21:43:43 - 
	c.m.c.ChatController:
	{[MESSAGE],[/chat]}: processMessage(ChatMessage)
	{[MESSAGE],[/call/offer]}: handleCallOffer(Map)
	{[MESSAGE],[/call/answer]}: handleCallAnswer(Map)
	{[MESSAGE],[/call/ice-candidate]}: handleIceCandidate(Map)
2025-12-15 21:43:43 - 
	c.m.c.PatientAnalysisController:
	
2025-12-15 21:43:43 - 
	c.m.c.DoctorController:
	
2025-12-15 21:43:43 - 
	c.m.c.UserController:
	
2025-12-15 21:43:43 - 
	o.s.b.a.w.s.e.BasicErrorController:
	
2025-12-15 21:43:43 - ControllerAdvice beans: 0 @ModelAttribute, 0 @InitBinder, 1 RequestBodyAdvice, 1 ResponseBodyAdvice
2025-12-15 21:43:43 - ControllerAdvice beans: 0 @ExceptionHandler, 1 ResponseBodyAdvice
2025-12-15 21:43:43 - Tomcat started on port 8082 (http) with context path ''
2025-12-15 21:43:43 - clientOutboundChannel added SubProtocolWebSocketHandler[StompSubProtocolHandler[v10.stomp, v11.stomp, v12.stomp]]
2025-12-15 21:43:43 - clientInboundChannel added WebSocketAnnotationMethodMessageHandler[prefixes=[/app/]]
2025-12-15 21:43:43 - Starting...
2025-12-15 21:43:43 - clientInboundChannel added SimpleBrokerMessageHandler [org.springframework.messaging.simp.broker.DefaultSubscriptionRegistry@47dc0cc5]
2025-12-15 21:43:43 - brokerChannel added SimpleBrokerMessageHandler [org.springframework.messaging.simp.broker.DefaultSubscriptionRegistry@47dc0cc5]
2025-12-15 21:43:43 - BrokerAvailabilityEvent[available=true, SimpleBrokerMessageHandler [org.springframework.messaging.simp.broker.DefaultSubscriptionRegistry@47dc0cc5]]
2025-12-15 21:43:43 - Started.
2025-12-15 21:43:43 - clientInboundChannel added UserDestinationMessageHandler[DefaultUserDestinationResolver[prefix=/user/]]
2025-12-15 21:43:43 - brokerChannel added UserDestinationMessageHandler[DefaultUserDestinationResolver[prefix=/user/]]
2025-12-15 21:43:43 - Started MyEmoHealthApplication in 11.219 seconds (process running for 12.113)
2025-12-15 21:43:43 - 
    /* select
        count(*) 
    from
        Role x */ select
            count(*) 
        from
            role r1_0
2025-12-15 21:43:43 - Roles already initialized, skipping...
2025-12-15 21:43:43 - Initializing users...
2025-12-15 21:43:43 - 
    /* <criteria> */ select
        r1_0.id,
        r1_0.description,
        r1_0.name 
    from
        role r1_0 
    where
        r1_0.name=?
2025-12-15 21:43:43 - 
    /* <criteria> */ select
        r1_0.id,
        r1_0.description,
        r1_0.name 
    from
        role r1_0 
    where
        r1_0.name=?
2025-12-15 21:43:43 - 
    /* SELECT
        u 
    FROM
        User u 
    LEFT JOIN
        
    FETCH
        u.role 
    WHERE
        u.email = :email */ select
            u1_0.id,
            u1_0.created_at,
            u1_0.email,
            u1_0.email_verified,
            u1_0.enabled,
            u1_0.first_name,
            u1_0.last_login,
            u1_0.last_name,
            u1_0.password_hash,
            u1_0.role_id,
            r1_0.id,
            r1_0.description,
            r1_0.name,
            u1_0.updated_at,
            u1_0.uuid 
        from
            "user" u1_0 
        left join
            role r1_0 
                on r1_0.id=u1_0.role_id 
        where
            u1_0.email=?
2025-12-15 21:43:43 - 
    /* insert for
        com.myemohealth.entity.User */insert 
    into
        "user" (created_at, email, email_verified, enabled, first_name, last_login, last_name, password_hash, role_id, updated_at, uuid) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)
2025-12-15 21:43:43 - 

Error starting ApplicationContext. To display the condition evaluation report re-run your application with 'debug' enabled.
2025-12-15 21:43:43 - Application run failed
java.lang.IllegalStateException: Failed to execute CommandLineRunner
	at org.springframework.boot.SpringApplication.callRunner(SpringApplication.java:789)
	at org.springframework.boot.SpringApplication.lambda$callRunners$3(SpringApplication.java:770)
	at java.base/java.util.stream.ForEachOps$ForEachOp$OfRef.accept(Unknown Source)
	at java.base/java.util.stream.SortedOps$SizedRefSortingSink.end(Unknown Source)
	at java.base/java.util.stream.AbstractPipeline.copyInto(Unknown Source)
	at java.base/java.util.stream.AbstractPipeline.wrapAndCopyInto(Unknown Source)
	at java.base/java.util.stream.ForEachOps$ForEachOp.evaluateSequential(Unknown Source)
	at java.base/java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(Unknown Source)
	at java.base/java.util.stream.AbstractPipeline.evaluate(Unknown Source)
	at java.base/java.util.stream.ReferencePipeline.forEach(Unknown Source)
	at org.springframework.boot.SpringApplication.callRunners(SpringApplication.java:765)
	at org.springframework.boot.SpringApplication.run(SpringApplication.java:330)
	at org.springframework.boot.SpringApplication.run(SpringApplication.java:1342)
	at org.springframework.boot.SpringApplication.run(SpringApplication.java:1331)
	at com.myemohealth.MyEmoHealthApplication.main(MyEmoHealthApplication.java:16)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(Unknown Source)
	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(Unknown Source)
	at java.base/java.lang.reflect.Method.invoke(Unknown Source)
	at org.springframework.boot.loader.launch.Launcher.launch(Launcher.java:91)
	at org.springframework.boot.loader.launch.Launcher.launch(Launcher.java:53)
	at org.springframework.boot.loader.launch.JarLauncher.main(JarLauncher.java:58)
Caused by: org.springframework.dao.InvalidDataAccessApiUsageException: detached entity passed to persist: com.myemohealth.entity.User
	at org.springframework.orm.jpa.vendor.HibernateJpaDialect.convertHibernateAccessException(HibernateJpaDialect.java:310)
	at org.springframework.orm.jpa.vendor.HibernateJpaDialect.translateExceptionIfPossible(HibernateJpaDialect.java:244)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.translateExceptionIfPossible(AbstractEntityManagerFactoryBean.java:550)
	at org.springframework.dao.support.ChainedPersistenceExceptionTranslator.translateExceptionIfPossible(ChainedPersistenceExceptionTranslator.java:61)
	at org.springframework.dao.support.DataAccessUtils.translateIfNecessary(DataAccessUtils.java:335)
	at org.springframework.dao.support.PersistenceExceptionTranslationInterceptor.invoke(PersistenceExceptionTranslationInterceptor.java:152)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.data.jpa.repository.support.CrudMethodMetadataPostProcessor$CrudMethodMetadataPopulatingMethodInterceptor.invoke(CrudMethodMetadataPostProcessor.java:164)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.interceptor.ExposeInvocationInterceptor.invoke(ExposeInvocationInterceptor.java:97)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.JdkDynamicAopProxy.invoke(JdkDynamicAopProxy.java:249)
	at jdk.proxy2/jdk.proxy2.$Proxy146.save(Unknown Source)
	at com.myemohealth.config.DataInitializer.initializeUsers(DataInitializer.java:129)
	at com.myemohealth.config.DataInitializer.run(DataInitializer.java:39)
	at org.springframework.boot.SpringApplication.callRunner(SpringApplication.java:786)
	... 21 common frames omitted
Caused by: org.hibernate.PersistentObjectException: detached entity passed to persist: com.myemohealth.entity.User
	at org.hibernate.event.internal.DefaultPersistEventListener.persist(DefaultPersistEventListener.java:88)
	at org.hibernate.event.internal.DefaultPersistEventListener.onPersist(DefaultPersistEventListener.java:77)
	at org.hibernate.event.service.internal.EventListenerGroupImpl.fireEventOnEachListener(EventListenerGroupImpl.java:138)
	at org.hibernate.internal.SessionImpl.firePersist(SessionImpl.java:808)
	at org.hibernate.internal.SessionImpl.persist(SessionImpl.java:756)
	at org.hibernate.engine.spi.CascadingActions$7.cascade(CascadingActions.java:290)
	at org.hibernate.engine.spi.CascadingActions$7.cascade(CascadingActions.java:280)
	at org.hibernate.engine.internal.Cascade.cascadeToOne(Cascade.java:517)
	at org.hibernate.engine.internal.Cascade.cascadeAssociation(Cascade.java:439)
	at org.hibernate.engine.internal.Cascade.cascadeProperty(Cascade.java:224)
	at org.hibernate.engine.internal.Cascade.cascade(Cascade.java:157)
	at org.hibernate.event.internal.AbstractSaveEventListener.cascadeBeforeSave(AbstractSaveEventListener.java:482)
	at org.hibernate.event.internal.AbstractSaveEventListener.performSaveOrReplicate(AbstractSaveEventListener.java:298)
	at org.hibernate.event.internal.AbstractSaveEventListener.performSave(AbstractSaveEventListener.java:219)
	at org.hibernate.event.internal.AbstractSaveEventListener.saveWithGeneratedId(AbstractSaveEventListener.java:134)
	at org.hibernate.event.internal.DefaultPersistEventListener.entityIsTransient(DefaultPersistEventListener.java:175)
	at org.hibernate.event.internal.DefaultPersistEventListener.persist(DefaultPersistEventListener.java:93)
	at org.hibernate.event.internal.DefaultPersistEventListener.onPersist(DefaultPersistEventListener.java:77)
	at org.hibernate.event.internal.DefaultPersistEventListener.onPersist(DefaultPersistEventListener.java:54)
	at org.hibernate.event.service.internal.EventListenerGroupImpl.fireEventOnEachListener(EventListenerGroupImpl.java:127)
	at org.hibernate.internal.SessionImpl.firePersist(SessionImpl.java:766)
	at org.hibernate.internal.SessionImpl.persist(SessionImpl.java:750)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(Unknown Source)
	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(Unknown Source)
	at java.base/java.lang.reflect.Method.invoke(Unknown Source)
	at org.springframework.orm.jpa.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler.invoke(SharedEntityManagerCreator.java:311)
	at jdk.proxy2/jdk.proxy2.$Proxy126.persist(Unknown Source)
	at org.springframework.data.jpa.repository.support.SimpleJpaRepository.save(SimpleJpaRepository.java:618)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(Unknown Source)
	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(Unknown Source)
	at java.base/java.lang.reflect.Method.invoke(Unknown Source)
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:352)
	at org.springframework.data.repository.core.support.RepositoryMethodInvoker$RepositoryFragmentMethodInvoker.lambda$new$0(RepositoryMethodInvoker.java:277)
	at org.springframework.data.repository.core.support.RepositoryMethodInvoker.doInvoke(RepositoryMethodInvoker.java:170)
	at org.springframework.data.repository.core.support.RepositoryMethodInvoker.invoke(RepositoryMethodInvoker.java:158)
	at org.springframework.data.repository.core.support.RepositoryComposition$RepositoryFragments.invoke(RepositoryComposition.java:516)
	at org.springframework.data.repository.core.support.RepositoryComposition.invoke(RepositoryComposition.java:285)
	at org.springframework.data.repository.core.support.RepositoryFactorySupport$ImplementationMethodExecutionInterceptor.invoke(RepositoryFactorySupport.java:628)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.data.repository.core.support.QueryExecutorMethodInterceptor.doInvoke(QueryExecutorMethodInterceptor.java:168)
	at org.springframework.data.repository.core.support.QueryExecutorMethodInterceptor.invoke(QueryExecutorMethodInterceptor.java:143)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.data.projection.DefaultMethodInvokingMethodInterceptor.invoke(DefaultMethodInvokingMethodInterceptor.java:70)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.transaction.interceptor.TransactionInterceptor$1.proceedWithInvocation(TransactionInterceptor.java:123)
	at org.springframework.transaction.interceptor.TransactionAspectSupport.invokeWithinTransaction(TransactionAspectSupport.java:385)
	at org.springframework.transaction.interceptor.TransactionInterceptor.invoke(TransactionInterceptor.java:119)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.dao.support.PersistenceExceptionTranslationInterceptor.invoke(PersistenceExceptionTranslationInterceptor.java:137)
	... 31 common frames omitted
2025-12-15 21:43:43 - clientOutboundChannel removed SubProtocolWebSocketHandler[StompSubProtocolHandler[v10.stomp, v11.stomp, v12.stomp]]
2025-12-15 21:43:43 - clientInboundChannel removed WebSocketAnnotationMethodMessageHandler[prefixes=[/app/]]
2025-12-15 21:43:43 - Stopping...
2025-12-15 21:43:43 - BrokerAvailabilityEvent[available=false, SimpleBrokerMessageHandler [org.springframework.messaging.simp.broker.DefaultSubscriptionRegistry@47dc0cc5]]
2025-12-15 21:43:43 - clientInboundChannel removed SimpleBrokerMessageHandler [org.springframework.messaging.simp.broker.DefaultSubscriptionRegistry@47dc0cc5]
2025-12-15 21:43:43 - brokerChannel removed SimpleBrokerMessageHandler [org.springframework.messaging.simp.broker.DefaultSubscriptionRegistry@47dc0cc5]
2025-12-15 21:43:43 - Stopped.
2025-12-15 21:43:43 - clientInboundChannel removed UserDestinationMessageHandler[DefaultUserDestinationResolver[prefix=/user/]]
2025-12-15 21:43:43 - brokerChannel removed UserDestinationMessageHandler[DefaultUserDestinationResolver[prefix=/user/]]
2025-12-15 21:43:43 - Closing JPA EntityManagerFactory for persistence unit 'default'
2025-12-15 21:43:43 - HikariPool-1 - Shutdown initiated...
2025-12-15 21:43:43 - HikariPool-1 - Shutdown completed.
